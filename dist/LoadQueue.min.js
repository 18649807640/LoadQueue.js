var Class=(function(){var c=function(j){j=j||{};var e=j.hasOwnProperty("constructor")?j.constructor:function(){};i.call(e,j);return e};var i=function(j){var k={},e,l;for(e in j){l=j[e];if(h.hasOwnProperty(e)){h[e].call(this,l)}else{k[e]=l}}d(this.prototype,k)};var h={Extends:function(j){var e=this.prototype,k=f(j.prototype);d(this,j);d(k,e);k.constructor=this;this.prototype=k;this.superclass=j.prototype},Mixes:function(e){e instanceof Array||(e=[e]);var k=this.prototype,j;while(j=e.shift()){d(k,j.prototype||j)}},Statics:function(e){d(this,e)}};var f=(function(){if(Object.__proto__){return function(j){return{__proto__:j}}}else{var e=function(){};return function(j){e.prototype=j;return new e()}}})();var d=function(n){for(var l=1,e=arguments.length;l<e;l++){var m=arguments[l],j;for(var k in m){var o=m[k];if(o&&typeof o==="object"){if(o.value!==undefined||typeof o.get==="function"||typeof o.set==="function"){j=j||{};j[k]=o;continue}}n[k]=o}if(j){b(n,j)}}return n};var a,b;try{a=Object.defineProperty;b=Object.defineProperties;a({},"$",{value:0})}catch(g){if("__defineGetter__" in Object){a=function(e,k,j){if("value" in j){e[k]=j.value}if("get" in j){e.__defineGetter__(k,j.get)}if("set" in j){e.__defineSetter__(k,j.set)}return e};b=function(j,e){for(var k in e){if(e.hasOwnProperty(k)){a(j,k,e[k])}}return j}}}return{create:c,mix:d}})();var EventMixin={_listeners:null,on:function(f,g,e){var d=(this._listeners=this._listeners||{});var h=(d[f]=d[f]||[]);for(var b=0,a=h.length;b<a;b++){var c=h[b];if(c.listener===g){return}}h.push({listener:g,once:e});return this},off:function(d,e){if(arguments.length==0){this._listeners=null;return this}var f=this._listeners&&this._listeners[d];if(f){if(arguments.length==1){delete this._listeners[d];return this}for(var b=0,a=f.length;b<a;b++){var c=f[b];if(c.listener===e){f.splice(b,1);if(f.length===0){delete this._listeners[d]}break}}}return this},fire:function(j,g){var b,c;if(typeof j==="string"){c=j}else{b=j;c=j.type}var k=this._listeners;if(!k){return false}var a=k[c];if(a){var d=a.slice(0);b=b||new EventObject(c,this,g);if(b._stopped){return false}for(var f=0;f<d.length;f++){var e=d[f];e.listener.call(this,b);if(e.once){var h=a.indexOf(e);if(h>-1){a.splice(h,1)}}}if(a.length==0){delete k[c]}return true}return false}};var EventObject=Class.create({constructor:function EventObject(b,c,a){this.type=b;this.target=c;this.detail=a;this.timeStamp=+new Date()},type:null,target:null,detail:null,timeStamp:0,stopImmediatePropagation:function(){this._stopped=true}});var RawEvent=window.Event;if(RawEvent){var proto=RawEvent.prototype,stop=proto.stopImmediatePropagation;proto.stopImmediatePropagation=function(){stop&&stop.call(this);this._stopped=true}}var ImageLoader=Class.create({load:function(b){var a=this;var c=new Image();if(b.crossOrigin){c.crossOrigin=b.crossOrigin}c.onload=function(){a.onLoad(c)};c.onerror=c.onabort=a.onError.bind(c);c.src=b.src+(b.noCache?(b.src.indexOf("?")==-1?"?":"&")+"t="+(+new Date()):"")},onLoad:function(a){a.onload=a.onerror=a.onabort=null;return a},onError:function(b){var a=b.target;a.onload=a.onerror=a.onabort=null;return b}});var ScriptLoader=Class.create({load:function(d){var c=this,g=d.src,b=d.type=="jsonp";if(b){var f=d.callbackName||"callback";var h=d.callback||"jsonp"+(++ScriptLoader._count);var e=window;if(!e[h]){e[h]=function(i){delete e[h]}}g+=(g.indexOf("?")==-1?"?":"&")+f+"="+h}if(d.noCache){g+=(g.indexOf("?")==-1?"?":"&")+"t="+(+new Date())}var a=document.createElement("script");a.type="text/javascript";a.async=true;a.onload=c.onLoad.bind(c);a.onerror=c.onError.bind(c);a.src=g;if(d.id){a.id=d.id}document.getElementsByTagName("head")[0].appendChild(a)},onLoad:function(b){var a=b.target;a.onload=a.onerror=null;return a},onError:function(b){var a=b.target;a.onload=a.onerror=null;return b},Statics:{_count:0}});var LoadQueue=Class.create({Mixes:EventMixin,constructor:function(a){this._source=[];this.add(a)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(b){var a=this;if(b){b=b instanceof Array?b:[b];a._source=a._source.concat(b)}return a},get:function(d){if(d){var c=this._source;for(var a=0;a<c.length;a++){var b=c[a];if(b.id===d||b.src===d){return b}}}return null},getContent:function(b){var a=this.get(b);return a&&a.content},start:function(){var a=this;a._loadNext();return a},_loadNext:function(){var g=this,h=g._source,b=h.length;if(g._loaded>=b){g.fire("complete");return}if(g._currentIndex<b-1&&g._connections<g.maxConnections){var c=++g._currentIndex;var f=h[c];var a=g._getLoader(f);if(a){var d=a.onLoad,e=a.onError;a.onLoad=function(j){a.onLoad=d;a.onError=e;var i=d&&d.call(a,j)||j.target;g._onItemLoad(c,i)};a.onError=function(i){a.onLoad=d;a.onError=e;e&&e.call(a,i);g._onItemError(c,i)};g._connections++}g._loadNext();a&&a.load(f)}},_getLoader:function(c){var a=c.loader;if(a){return a}var b=c.type||getExtension(c.src);switch(b){case"png":case"jpg":case"jpeg":case"gif":case"webp":a=new ImageLoader();break;case"js":case"jsonp":a=new ScriptLoader();
break}return a},_onItemLoad:function(a,d){var c=this,b=c._source[a];b.loaded=true;b.content=d;c._connections--;c._loaded++;c.fire("load",b);c._loadNext()},_onItemError:function(a,d){var c=this,b=c._source[a];b.error=d;c._connections--;c._loaded++;c.fire("error",b);c._loadNext()},getSize:function(a){var c=0,e=this._source;for(var b=0;b<e.length;b++){var d=e[b];c+=(a?d.loaded&&d.size:d.size)||0}return c},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length}});function getExtension(c){var b=/\/?[^/]+\.(\w+)(\?\S+)?$/i,a,d;if(a=c.match(b)){d=a[1].toLowerCase()}return d||null}module.exports=LoadQueue;